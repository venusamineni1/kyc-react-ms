CREATE TABLE IF NOT EXISTS ScreeningLogs (
    LogID BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    ClientID BIGINT, -- No FK constraint as Client table is in another service
    RequestPayload TEXT, -- H2 compatible
    ResponsePayload TEXT,
    OverallStatus VARCHAR(50),
    ExternalRequestID VARCHAR(100),
    CreatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS ScreeningResults (
    ResultID BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    ScreeningLogID BIGINT,
    ContextType VARCHAR(50), -- PEP, ADM, INT, SAN
    Status VARCHAR(50), -- HIT, NO_HIT, IN_PROGRESS
    AlertStatus VARCHAR(50),
    AlertMessage TEXT,
    AlertID VARCHAR(100),
    FOREIGN KEY (ScreeningLogID) REFERENCES ScreeningLogs(LogID)
);

CREATE TABLE IF NOT EXISTS BatchRuns (
    BatchID BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    BatchName VARCHAR(255) NOT NULL,
    RunStatus VARCHAR(50), -- INITIATED, UPLOADED, NOTIFICATION_RECEIVED, PROCESSED, FAILED
    NotificationStatus VARCHAR(50),
    FeedbackCount INT,
    CreatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UpdatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS BatchRunErrors (
    ErrorID BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    BatchID BIGINT,
    RecordID VARCHAR(100),
    ErrorCode VARCHAR(50),
    ErrorMessage TEXT,
    FOREIGN KEY (BatchID) REFERENCES BatchRuns(BatchID)
);

CREATE TABLE IF NOT EXISTS BatchFeedbackResults (
    ResultID BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    BatchID BIGINT,
    RecordID VARCHAR(100),
    MatchID VARCHAR(100),
    MatchName VARCHAR(255),
    MatchScore VARCHAR(50),
    Status VARCHAR(50),
    FOREIGN KEY (BatchID) REFERENCES BatchRuns(BatchID)
);

CREATE TABLE IF NOT EXISTS MappingConfigs (
    MappingID BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    TargetPath VARCHAR(255) NOT NULL,
    SourceField VARCHAR(255),
    DefaultValue VARCHAR(255),
    Transformation VARCHAR(255)
);
